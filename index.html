<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pantalla AR con Video y Audio</title>

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
body { margin:0; background:#000; display:flex; justify-content:center; align-items:center; flex-direction:column; height:100vh; }
model-viewer { width:90vw; height:80vh; background:#000; }
button { margin-top:20px; padding:12px 25px; font-size:16px; cursor:pointer; border-radius:6px; border:none; background:#ff3d00; color:#fff; }
button:hover { background:#ff5722; }
</style>
</head>
<body>

<!-- Video oculto -->
<video id="video" src="dama.mp4" loop playsinline crossorigin="anonymous" style="display:none"></video>

<!-- Modelo GLB con AR habilitado -->
<model-viewer id="viewer"
  src="pantalla.glb"
  ar
  ar-modes="scene-viewer quick-look webxr"
  camera-controls
  shadow-intensity="1"
  exposure="1">
</model-viewer>

<button id="playVideoAudio">Reproducir Video con Audio</button>

<script>
const viewer = document.getElementById("viewer");
const video = document.getElementById("video");
const button = document.getElementById("playVideoAudio");

button.addEventListener("click", async () => {
  try {
    video.muted = false; // o true si quieres autoplay sin audio
    await video.play();

    const texture = await viewer.createTexture(video);

    // üîπ Hack de prueba: aplicar video a todos los materiales
    viewer.model.materials.forEach(mat => {
      mat.pbrMetallicRoughness.setBaseColorTexture(texture);
      mat.pbrMetallicRoughness.setMetallicFactor(0);
      mat.pbrMetallicRoughness.setRoughnessFactor(1);
    });

    console.log("Video aplicado a todos los materiales. Ahora revisa si se ve en el plano.");

    if(viewer.canActivateAR) {
      viewer.activateAR();
    }

  } catch (e) {
    console.error("Error aplicando video:", e);
  }
});
    }

    material.pbrMetallicRoughness.setBaseColorTexture(texture);
    material.pbrMetallicRoughness.setMetallicFactor(0);
    material.pbrMetallicRoughness.setRoughnessFactor(1);

    console.log("Video con audio aplicado correctamente en el plano.");

    // Iniciar AR autom√°ticamente si se puede
    if (viewer.canActivateAR) {
      viewer.activateAR();
    }

  } catch (e) {
    console.error("Error aplicando video con audio:", e);
  }
});
</script>

</body>
</html>
